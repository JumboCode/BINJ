<!DOCTYPE html>

<html>

    <head>
        <title>BINJ Map</title>
        <link rel="icon" type="img/png" href="favicon.png">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

        <link rel="stylesheet" href="style.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link rel="stylesheet" href="tags/bootstrap-tagsinput.css">
        <script src="tags/bootstrap-tagsinput.js"></script>

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="./test-data.js"></script>



        <script>
            $('#tags-input').tagsinput({
                confirmKeys: [13, 188]
            });
            $('#tags-input input').on('keypress', function(e){
                if (e.keyCode == 13){
                    e.keyCode = 188;
                    e.preventDefault();
                }
            });
            var tags = [];
            var changed = false;
            $(document).ready(function () {
                $('#form')
                    .find('[name="search"]')
                        .change(function (e) {
                            $('input').removeAttr('placeholder');
                            $('input').on('itemRemoved', function(event) {
                                var index = tags.indexOf(event.item);
                                if (index > -1) tags.splice(index, 1);
                                // event.item: contains the item
                                var filters = "map.html?filter=" + getFilters();
                                console.log(filters);
                                $("#iframe").attr("src", filters);
                                console.log(tags);

                            });
                            tags.push($("input").val());

                            var filters = "map.html" + getFilters();
                            console.log(filters);
                            $("#iframe").attr("src", filters);

                        })
                    .end();

            });
            function getFilters() {
                var str = "";
                for (var i = 0; i < tags.length; i++) {
                    if (tags[i] == "") tags.splice(i, 1);
                    str += tags[i] + "+";

                }

                //Getting filters from checked boxes
                $.each($("input:checked"), function() {
                    str += "+" + ($(this).val());
                });
                changed = true;
                if (str != "") return ("?filter=" + str.substring(0, str.length - 1));
                else return "";

            }

        </script>

    </head>

    <body>

        <div class=wrapper>
            <a href="https://www.google.com" id="signin"> Sign in/Sign up</a>
        </div>
        <div class=logo>

            <img src="https://cdn-images-1.medium.com/max/246/1*SQumLd1QIKdVJAM5nfvuqA@2x.png"/ />
            <div id="title">
                <h1>
                    Boston Institute for Nonprofit Journalism
                </h1>
                <h4>
                    Reporting incubator and convener boosting independent media and journalists in Greater Boston
                </h4>
            </div>
        </div>

        <div id="content">
        <div id="map-list">

            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#map-view">Filter</a></li>
                <li><a data-toggle="tab" href="#list-view">List</a></li>
            </ul>

            <div class="tab-content">
                <div id="map-view" class="tab-pane fade in active">
                    <div id="filters">

                        <form id="form">
                        <input type="text" id= "search" name="search" placeholder="Search for tags..." data-role="tagsinput" value="">
                        </form>

                        <h3>Filter stories by...</h3>
                        <button type="button" class="btn btn-lg btn-info collapsed" data-toggle="collapse" data-target="#storytype">Story type</button>
                        <div id="storytype" class="collapse">
                            <div class="checkbox"><label><input type = "checkbox" value="Politics">Politics</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Sports">Sports</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Arts">Arts</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Feature">Feature</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Columns">Columnns</label>
                            </div></br>
                        </div>
                        <hr />

                        <button type="button" class="btn btn-lg btn-info collapsed" data-toggle="collapse" data-target="#author">Author</button>
                        <div id="author" class="collapse">
                            <div class="checkbox"><label><input type = "checkbox" value="Author1">Author1</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Author2">Author2</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Author3">Author3</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Author4">Author4</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Author5">Author5</label></div>
                        </div>

                        <hr />

                        <button type="button" class="btn btn-lg btn-info collapsed" data-toggle="collapse" data-target="#publisher">Publisher</button>
                        <div id="publisher" class="collapse">
                            <div class="checkbox"><label><input type = "checkbox" value="Publisher1">Publisher1</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Publisher2">Publisher2</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Publisher3">Publisher3</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Publisher4">Publisher4</label>
                            </div>
                            <div class="checkbox"><label><input type = "checkbox" value="Publisher5">Publisher5</label></div>
                        </div>

                        <hr />
                    </div>
                </div>
                <div id="list-view" class="tab-pane fade in">
                    <h3>LIST VIEW</h3>
                    <p>Some shit'll get loaded here by some javascript</p>
                </div>
            </div>
          </div>
                <iframe id="iframe" src="map.html" width="100%" height="100%">
                </iframe>
        </div>

        <script>
            $('#content').height($(window).height() - $('.logo').height() - $('.wrapper').height());

        </script>

    </body>

</html>
